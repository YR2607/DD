---
import Layout from '../../layouts/Layout.astro';
import { PortableText } from 'astro-portabletext';
import { getContactPage, getSiteSettings } from '../../lib/sanity';

const contactData = await getContactPage();
const settings = await getSiteSettings();

// SEO
const metaTitle = contactData?.metaTitle || 'Contact | aspectmobili by HITOBA DESIGN';
const metaDescription = contactData?.metaDescription || settings?.description || '';

// Fallbacks
const hero = contactData?.hero || {
  title: 'Contact',
  subtitle: 'ASPECTMOBILI',
  description: ''
};

const formTitle = contactData?.formTitle || 'Send us a message';
const infoTitle = contactData?.infoTitle || 'Get in touch';
const officeLabel = contactData?.officeLabel || 'Office';
const mapTitle = contactData?.mapTitle || 'Find us';

const email = settings?.email || '';
const phone = settings?.phone || '';
const address = settings?.address || '';
const googleMapsUrl = settings?.googleMapsUrl || '';
const socialLinks = settings?.socialLinks || [];
---

<Layout title={metaTitle} description={metaDescription} bodyClass="contact-page">
    <!-- Contact Header -->
    <section class="contact-header-section">
        <div class="container">
            <h1 class="contact-page-heading">{hero.title}</h1>
            {hero.description && (
                <div class="contact-page-desc">
                    <PortableText value={hero.description} />
                </div>
            )}
        </div>
    </section>

    <!-- Contact Main Section -->
    <section class="contact-main section-padding">
        <div class="container">
            <div class="contact-grid">
                <!-- Left: Contact Form -->
                <div class="contact-form-block reveal">
                    <h2 class="contact-section-title">{formTitle}</h2>
                    <form class="contact-form" id="contact-form" data-email={email}>
                        <div class="form-group">
                            <label for="contact-name">Name</label>
                            <input type="text" id="contact-name" name="name" required autocomplete="name" />
                            <div class="form-line"></div>
                        </div>
                        <div class="form-group">
                            <label for="contact-email">Email</label>
                            <input type="email" id="contact-email" name="email" required autocomplete="email" />
                            <div class="form-line"></div>
                        </div>
                        <div class="form-group">
                            <label for="contact-company">Company</label>
                            <input type="text" id="contact-company" name="company" autocomplete="organization" />
                            <div class="form-line"></div>
                        </div>
                        <div class="form-group">
                            <label for="contact-message">Message</label>
                            <textarea id="contact-message" name="message" rows="4" required></textarea>
                            <div class="form-line"></div>
                        </div>
                        <button type="submit" class="contact-submit-btn">
                            <span class="btn-circle"></span>
                            <span class="btn-text">SEND</span>
                        </button>
                    </form>
                </div>

                <!-- Right: Contact Info -->
                <div class="contact-info-block reveal">
                    <h2 class="contact-section-title">{infoTitle}</h2>

                    <div class="contact-info-list">
                        {email && (
                            <div class="contact-info-item">
                                <span class="contact-info-label">Email</span>
                                <a href={`mailto:${email}`} class="contact-info-value">{email}</a>
                            </div>
                        )}

                        {phone && (
                            <div class="contact-info-item">
                                <span class="contact-info-label">Phone</span>
                                <a href={`tel:${phone}`} class="contact-info-value">{phone}</a>
                            </div>
                        )}

                        {address && (
                            <div class="contact-info-item">
                                <span class="contact-info-label">{officeLabel}</span>
                                <p class="contact-info-value contact-address">{address}</p>
                            </div>
                        )}

                        {socialLinks.length > 0 && (
                            <div class="contact-info-item">
                                <span class="contact-info-label">Social</span>
                                <div class="contact-socials">
                                    {socialLinks.map((link: any) => (
                                        <a href={link.url} target="_blank" rel="noopener noreferrer" class="contact-social-link">
                                            {link.platform}
                                        </a>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    {googleMapsUrl && (
        <section class="contact-map-section" id="contact-map">
            <div class="container">
                <div class="contact-map-header reveal">
                    <span class="section-number">(03)</span>
                    <h2 class="section-title">{mapTitle}</h2>
                </div>
            </div>
            <div class="contact-map-wrapper reveal">
                <iframe
                    src={googleMapsUrl}
                    width="100%"
                    height="500"
                    style="border:0;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    title="Office Location"
                ></iframe>
            </div>
        </section>
    )}

</Layout>
