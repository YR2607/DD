---
import Layout from '../layouts/Layout.astro';
import { getHomePage, getProjects, urlFor } from '../lib/sanity';

const homeData = await getHomePage();
const projects = await getProjects();

// Fallbacks
const heroLogoText = homeData?.heroLogoText || 'aspectmobili';
const heroSlides = homeData?.heroSlides || [
  { 
    title: 'NTT DATA INTELLILINK', 
    area: '3206m2', 
    year: '2024', 
    image: '/work1.png',
    projectLink: '/works/project-1/'
  },
  { 
    title: 'SocioFuture, Ltd.', 
    area: '3967m2', 
    year: '2025', 
    image: '/work2.png',
    projectLink: '/works/project-2/'
  }
];

const aboutSections = homeData?.aboutSections || [
  {
    number: '(01)',
    title: 'Beyond Spatial Design',
    leadText: 'We believe that offices are not just places to work, but architectural fragments that shape culture and productivity.',
    bodyText: 'Aspectmobili is a design manifest by HITOBA. We integrate minimal aesthetics with structural intelligence to create spaces that breathe and evolve with your business.',
    image: '/about_arch.png',
    caption: 'FRAGMENT 205 — TOKYO',
    inverted: false
  },
  {
    number: '(02)',
    title: 'Structural Intelligence',
    leadText: 'Complexity refined into simplicity. Our approach to structural design is rooted in the dialogue between matter and light.',
    bodyText: 'We leverage advanced structural engineering to push the boundaries of what a workspace can be, ensuring durability and timeless aesthetic value in every fragment.',
    image: '/about_arch_2.png',
    caption: 'FRAGMENT 402 — STRUCTURAL',
    inverted: true
  }
];

const contactPortal = homeData?.contactPortal || {
  tag: 'GET IN TOUCH',
  title: 'Start your project',
  btnText: 'CONTACT US'
};

// Featured projects for the showcase (take first 6 or from CMS)
const featuredProjects = projects.length > 0 ? projects.slice(0, 6) : [];
---

<Layout title="aspectmobili by HITOBA DESIGN | Tokyo Office Design & Layout" description="Tokyo's leading office design and layout agency focusing on productivity and branding.">
    <!-- Big Logo Text (Fixed) -->
    <div class="hero-logo-text" id="hero-logo">
      <span>{heroLogoText}</span>
    </div>

    <!-- Hero Section -->
    <section class="hero-section" id="hero-section">
      <div class="hero-pin-wrapper">
        <!-- Hero Slider -->
        <div class="hero-slider" id="hero-slider">
          {featuredProjects.map((project, index) => (
            <div 
              class={`hero-slide ${index === 0 ? 'active' : ''}`} 
              data-index={index} 
              data-title={project.title} 
              data-area={project.area}
              data-year={project.completionYear}
              data-id={project.id}
            >
              <div class="slide-image-wrapper">
                <img 
                  src={project.mainImage?.asset ? urlFor(project.mainImage).width(1800).url() : '/placeholder.png'} 
                  alt={project.title} 
                  class="slide-img"
                >
                <div class="slide-overlay-text">See Detail</div>
              </div>
            </div>
          ))}
        </div>

        <!-- Project Info Bar (Centered with Line) -->
        <div class="hero-info-bar" id="hero-info-bar">
          <div class="info-container">
            <div class="info-line-wrapper">
              <div class="info-horizontal-line">
                <div class="info-progress-bar" id="info-progress-bar"></div>
              </div>
            </div>
            <div class="info-content-container">
              <div class="info-left">
                <div class="counter-wrap overflow-hidden">
                  <span class="slide-counter"><span id="current-slide">1</span> / <span
                      id="total-slides">{featuredProjects.length}</span></span>
                </div>
                <div class="title-wrap overflow-hidden">
                  <span class="project-name" id="project-name">{featuredProjects.length > 0 ? featuredProjects[0].title : ''}</span>
                </div>
              </div>
              <div class="info-right">
                <div class="link-wrap overflow-hidden">
                  <a href={featuredProjects.length > 0 ? `/works/${featuredProjects[0].slug?.current || ''}` : '#'} class="see-detail-link" id="see-work-detail">See Work Detail</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- After Scroll: Project Details (Now inside pin-wrapper) -->
        <div class="project-details-container" id="project-details">
          <div class="project-details-content">
            <div class="project-title-area">
              <h2 class="project-main-title" id="detail-title">{featuredProjects.length > 0 ? featuredProjects[0].title : ''}</h2>
            </div>
            <div class="project-meta-area">
              <div class="meta-row-group">
                <div class="meta-block">
                  <span class="meta-label">Area</span>
                  <span class="meta-value" id="detail-area">{featuredProjects.length > 0 ? featuredProjects[0].area : ''}</span>
                </div>
                <div class="meta-block">
                  <span class="meta-label">Completion</span>
                  <span class="meta-value" id="detail-year">{featuredProjects.length > 0 ? featuredProjects[0].completionYear : ''}</span>
                </div>
              </div>
              <div class="meta-tags" id="detail-tags">
                 {featuredProjects.length > 0 && featuredProjects[0].categories?.map((cat: string) => (
                    <span>{cat}</span>
                 ))}
              </div>
            </div>
          </div>
        </div>

        <!-- Scroll Arrow -->
        <div class="scroll-arrow" id="scroll-arrow">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7 7 7-7" />
          </svg>
        </div>
      </div>
    </section>

    <!-- Works Showcase -->
    <section class="works-showcase">
      <div class="container">
        <div class="works-grid">
          {featuredProjects.map((project) => (
            <article class="work-card reveal" data-id={project.id}>
              <a href={`/works/${project.slug?.current || ''}`} class="card-inner">
                <div class="card-image-box">
                  <div class="card-image">
                    <img 
                      src={project.mainImage ? urlFor(project.mainImage).width(800).url() : '/placeholder.png'} 
                      alt={project.title}
                    >
                  </div>
                </div>
                <div class="card-info-external">
                  <div class="info-left">
                    <h3 class="card-title">{project.title}</h3>
                  </div>
                  <div class="info-right">
                    <div class="meta-row-group">
                      <div class="meta-row">
                        <span class="label">Area</span>
                        <span class="value">{project.area}</span>
                      </div>
                      <div class="meta-row">
                        <span class="label">Completion</span>
                        <span class="value">{project.completionYear}</span>
                      </div>
                    </div>
                    <div class="meta-tags">
                      {project.categories?.map((cat) => (
                        <span>{cat}</span>
                      ))}
                    </div>
                  </div>
                </div>
              </a>
            </article>
          ))}
          
          {featuredProjects.length === 0 && (
             <p class="reveal">No projects found. Add some in Sanity Studio!</p>
          )}
        </div>

        <div class="view-all-container">
          <a href="/works/" class="btn-view-all">
            <span class="btn-text">See All Works</span>
            <span class="arrow">&#8595;</span>
          </a>
        </div>
      </div>
    </section>

    <!-- Architectural About Section -->
    <section class="about-architectural section-padding" id="about-architectural">
      <div class="container">
        {aboutSections.map((section) => (
          <div class={`about-row ${section.inverted ? 'inverted' : ''}`}>
            <div class="about-grid">
              {section.inverted ? (
                <>
                  <div class="about-visual reveal">
                    <div class="about-image-mask">
                      <img 
                        src={section.image?.asset ? urlFor(section.image).width(1200).url() : section.image} 
                        alt={section.title} 
                        class="about-img"
                      >
                    </div>
                    <div class="about-caption left">
                      <span>{section.caption}</span>
                    </div>
                  </div>
                  <div class="about-info reveal">
                    <span class="about-number">{section.number}</span>
                    <h2 class="about-title">{section.title}</h2>
                    <div class="about-text-content">
                      <p class="lead">{section.leadText}</p>
                      <p>{section.bodyText}</p>
                    </div>
                  </div>
                </>
              ) : (
                <>
                  <div class="about-info reveal">
                    <span class="about-number">{section.number}</span>
                    <h2 class="about-title">{section.title}</h2>
                    <div class="about-text-content">
                      <p class="lead">{section.leadText}</p>
                      <p>{section.bodyText}</p>
                    </div>
                  </div>
                  <div class="about-visual reveal">
                    <div class="about-image-mask">
                      <img 
                        src={section.image?.asset ? urlFor(section.image).width(1200).url() : section.image} 
                        alt={section.title} 
                        class="about-img"
                      >
                    </div>
                    <div class="about-caption">
                      <span>{section.caption}</span>
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Contact Portal Section -->
    <section class="contact-portal" id="contact-portal">
      <div class="portal-container">
        <a href="/contact/" class="portal-link">
          <div class="portal-content">
            <span class="portal-tag">{contactPortal.tag}</span>
            <h2 class="portal-title" set:html={contactPortal.title}></h2>
            <div class="portal-magnetic-btn">
              <span class="btn-circle"></span>
              <span class="btn-text">{contactPortal.btnText}</span>
            </div>
          </div>
        </a>
      </div>
    </section>
</Layout>
