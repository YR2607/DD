---
import Layout from '../../layouts/Layout.astro';
import { getAboutPage, getSiteSettings, urlFor } from '../../lib/sanity';

const aboutData = await getAboutPage();
const settings = await getSiteSettings();

// SEO
const metaTitle = aboutData?.metaTitle || 'About | aspectmobili by HITOBA DESIGN';
const metaDescription = aboutData?.metaDescription || settings?.description || '';

// Fallbacks
const hero = aboutData?.hero || {
  title: 'About',
  subtitle: 'ASPECTMOBILI',
  description: ''
};

const sections = aboutData?.sections || [];
const spreadImages = aboutData?.spreadImages || [];

const style = aboutData?.style || {
  title: 'Style',
  items: []
};

const contactPortal = settings?.contactPortal || {
  tag: 'GET IN TOUCH',
  title: 'Start your<br>project',
  btnText: 'CONTACT US',
  link: '/contact/'
};
---

<Layout title={metaTitle} description={metaDescription} bodyClass="about-page">
    <section class="about-hero" id="about-hero">
        <div class="about-hero-top-left">
            <h1 class="about-page-title reveal-hero">{hero.title}</h1>
        </div>

        <div class="about-hero-center">
            <div class="hero-main-logo reveal-hero">
                <span>{hero.subtitle}</span>
            </div>
        </div>

        <div class="about-hero-bottom-right">
            <div class="hero-description reveal-hero">
                <p set:html={hero.description}></p>
            </div>
        </div>

        <div class="scroll-hint reveal-hero">
            <span>Scroll</span>
            <div class="hint-line"></div>
        </div>
    </section>

    <!-- Content Sections (Iteration) -->
    {sections.map((section: any, index: number) => (
        <section class={`about-concept section-padding ${index % 2 !== 0 ? 'about-approach' : ''}`}>
            <div class="container">
                <div class={index % 2 !== 0 ? 'about-grid' : 'concept-grid'}>
                    <div class={index % 2 !== 0 ? 'about-info reveal' : 'concept-lead reveal'}>
                        <span class={index % 2 !== 0 ? 'about-number' : 'section-number'}>{section.number}</span>
                        <h2 class={index % 2 !== 0 ? 'about-title' : 'section-title'}>{section.title}</h2>
                        <div class={index % 2 !== 0 ? 'about-text-content' : ''}>
                            <p class={index % 2 !== 0 ? 'lead' : 'lead-text'}>{section.leadText}</p>
                            <p>{section.bodyText}</p>
                        </div>
                    </div>
                    {section.caption && (
                         <div class={index % 2 !== 0 ? 'about-visual reveal' : 'concept-content reveal'}>
                            <div class="about-caption">
                                <span>{section.caption}</span>
                            </div>
                         </div>
                    )}
                </div>
            </div>
        </section>
    ))}

    <!-- Image Spread Section (Horizontal Slider) -->
    {spreadImages.length > 0 && (
        <section class="about-spread">
            <div class="about-spread-container">
                <div class="about-spread-track">
                    {spreadImages.map((img: any) => (
                        <div class="spread-item">
                            <img src={img.asset ? urlFor(img).width(1200).url() : img} alt="Office Archive">
                        </div>
                    ))}
                </div>
            </div>
        </section>
    )}

    <!-- Style Section (Split Title) -->
    {style.items && style.items.length > 0 && (
        <section class="about-style section-padding">
            <div class="style-wrapper">
                <div class="style-sticky-left">
                    <h2 class="style-section-title">{style.title}</h2>
                    <div class="style-counter">
                        <div class="style-counter-track">
                            {style.items?.map((_: any, i: number) => (
                                <span>{String(i + 1).padStart(2, '0')}</span>
                            ))}
                        </div>
                    </div>
                </div>

                <ol class="style-items">
                    {style.items?.map((item: any, index: number) => (
                        <li class="style-item" data-index={index}>
                            <span class="style-label">{item.label || ''}</span>
                            <h3 class="style-heading">{item.title}</h3>
                            <p class="style-body">{item.text}</p>
                        </li>
                    ))}
                </ol>
            </div>
        </section>
    )}

    <section class="contact-portal" id="contact-portal">
        <div class="portal-container">
            <a href={contactPortal.link || '/contact/'} class="portal-link">
                <div class="portal-content">
                    <span class="portal-tag">{contactPortal.tag}</span>
                    <h2 class="portal-title" set:html={contactPortal.title}></h2>
                    <div class="portal-magnetic-btn">
                        <span class="btn-circle"></span>
                        <span class="btn-text">{contactPortal.btnText}</span>
                    </div>
                </div>
            </a>
        </div>
    </section>
</Layout>
