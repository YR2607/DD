import{c as w}from"./compiler-runtime.BVN8GnAY.js";import{r as f}from"./index.DB4Po_jQ.js";import{o as R,b4 as P,Q as I,b5 as S,b6 as D}from"./studio-component.CBxzOH7u.js";import{t as l,$ as O,a7 as x}from"./index.GAdVpEDN.js";import"./client.C73kiKoU.js";const A=n=>{const e=w.c(14),{comlink:t,perspective:d}=n;let o;e[0]!==d?(o=S(d)?P:{apiVersion:I},e[0]=d,e[1]=o):o=e[1];const s=R(o);let a,r;e[2]!==s||e[3]!==t?(a=()=>{const i=s.listen('*[!(_id in path("_.**"))]',{},{effectFormat:"mendoza",events:["welcome","mutation","reconnect"],includePreviousRevision:!1,includeResult:!1,includeAllVersions:!0,tag:"presentation-documents",visibility:"transaction"}).pipe(l(C)),v=i.pipe(l(N),O({bufferSize:1,refCount:!1})),y=t.on("visual-editing/snapshot-welcome",async()=>({event:await new Promise(b=>{v.pipe(D()).subscribe(h=>{b(h)})})})),_=i.pipe(l(T)),E=i.pipe(l(V)),g=x(v,E,_).subscribe(b=>{t.post("presentation/snapshot-event",{event:b})});return()=>{y(),g.unsubscribe()}},r=[s,t],e[2]=s,e[3]=t,e[4]=a,e[5]=r):(a=e[4],r=e[5]),f.useEffect(a,r);let c,u;e[6]!==s||e[7]!==t?(c=()=>t.on("visual-editing/fetch-snapshot",async i=>({snapshot:await s.getDocument(i.documentId,{tag:"document.snapshots"})})),u=[s,t],e[6]=s,e[7]=t,e[8]=c,e[9]=u):(c=e[8],u=e[9]),f.useEffect(c,u);let p,m;return e[10]!==s||e[11]!==t?(p=()=>t.on("visual-editing/mutate",async i=>s.dataRequest("mutate",i,{visibility:"async",returnDocuments:!0})),m=[s,t],e[10]=s,e[11]=t,e[12]=p,e[13]=m):(p=e[12],m=e[13]),f.useEffect(p,m),null};var q=f.memo(A);function C(n){return n.type==="welcome"||n.type==="reconnect"||n.type==="mutation"}function N(n){return n.type==="welcome"}function T(n){return n.type==="reconnect"}function V(n){return n.type==="mutation"}export{q as default};
