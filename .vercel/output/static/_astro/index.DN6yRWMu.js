import{ez as y,eA as v,eB as o,eC as t,eD as i,eE as r,eF as c,eG as l,eH as d}from"./index.GAdVpEDN.js";const p={"handshake/syn":d,"handshake/syn-ack":l,"handshake/ack":c,"channel/response":r,"channel/heartbeat":i,"channel/disconnect":t,"overlay/focus":"visual-editing/focus","overlay/navigate":"visual-editing/navigate","overlay/toggle":"visual-editing/toggle","presentation/toggleOverlay":"presentation/toggle-overlay"},u={[d]:"handshake/syn",[l]:"handshake/syn-ack",[c]:"handshake/ack",[r]:"channel/response",[i]:"channel/heartbeat",[t]:"channel/disconnect","visual-editing/focus":"overlay/focus","visual-editing/navigate":"overlay/navigate","visual-editing/toggle":"overlay/toggle","presentation/toggle-overlay":"presentation/toggleOverlay"},m=a=>{const{data:e}=a;return e&&typeof e=="object"&&"domain"in e&&"type"in e&&"from"in e&&"to"in e&&(e.domain==="sanity/channels"&&(e.domain=o),e.to==="overlays"&&(e.to="visual-editing"),e.from==="overlays"&&(e.from="visual-editing"),e.channelId=e.connectionId,delete e.connectionId,e.type=p[e.type]??e.type),a},k=a=>{const{channelId:e,...s}=a,n={...s,connectionId:e};return n.domain===o&&(n.domain="sanity/channels"),n.to==="visual-editing"&&(n.to="overlays"),n.from==="visual-editing"&&(n.from="overlays"),n.type=u[n.type]??n.type,n.type==="channel/response"&&n.responseTo&&!n.data&&(n.data={responseTo:n.responseTo}),(n.type==="handshake/syn"||n.type==="handshake/syn-ack"||n.type==="handshake/ack")&&(n.data={id:n.connectionId}),n},f=({context:a},e)=>{const{sources:s,targetOrigin:n}=a,g=k(e.message);s.forEach(h=>{h.postMessage(g,{targetOrigin:n})})},A=()=>({listen:v(m),requestMachine:y().provide({actions:{"send message":f}})});function S(){return window.self!==window.top}function C(){return!!window.opener}export{C as a,A as c,S as i};
